# 網站部署指南

## ⚠️ 重要說明：Netlify 的限制

### Netlify 是什麼？

Netlify 是一個**靜態網站託管服務**，主要用於：
- ✅ 前端應用（React、Vue、Angular 等）
- ✅ 靜態網站
- ❌ **不支援** Node.js 後端 API
- ❌ **不提供** MySQL 資料庫服務

### 您的專案架構

您的專案包含三個部分：

1. **前端（React）** ✅ 可以部署到 Netlify
   - 位置：`client/` 目錄
   - 可以正常部署

2. **後端 API（Node.js + Express）** ❌ 不能部署到 Netlify
   - 位置：`server/` 目錄
   - 需要部署到其他服務

3. **資料庫（MySQL）** ❌ Netlify 不提供
   - 需要單獨的資料庫服務

## 🎯 部署方案

### 方案一：分離部署（推薦）

#### 前端 → Netlify
- 部署 React 前端應用
- 免費方案可用

#### 後端 API → Railway / Render / Heroku
- 部署 Node.js 後端
- 提供 API 服務

#### 資料庫 → PlanetScale / Supabase / Railway
- 託管 MySQL 資料庫
- 或使用 PostgreSQL（Supabase）

**優點：**
- ✅ 各服務專精，效能好
- ✅ 可以選擇最適合的服務
- ✅ 擴展性佳

**缺點：**
- ⚠️ 需要管理多個服務
- ⚠️ 設定較複雜

---

### 方案二：全端部署（簡單）

#### 使用 Railway 或 Render（推薦）

**Railway：**
- ✅ 支援 Node.js 後端
- ✅ 提供 PostgreSQL 資料庫（可改用 MySQL）
- ✅ 可以同時部署前後端
- ✅ 免費方案可用

**Render：**
- ✅ 支援 Node.js 後端
- ✅ 提供 PostgreSQL 資料庫
- ✅ 免費方案可用

**優點：**
- ✅ 一站式解決方案
- ✅ 設定簡單
- ✅ 前後端在同一平台

**缺點：**
- ⚠️ 免費方案有資源限制

---

### 方案三：混合部署

#### 前端 → Netlify（免費）
#### 後端 + 資料庫 → Railway / Render

**優點：**
- ✅ 前端使用 Netlify 的 CDN（速度快）
- ✅ 後端和資料庫在一起（連線快）

---

## 📋 推薦部署流程

### 選項 A：使用 Railway（最簡單）⭐

1. **註冊 Railway**
   - 前往：https://railway.app
   - 使用 GitHub 登入

2. **部署後端**
   - 連接 GitHub 儲存庫
   - 選擇 `server/` 目錄
   - Railway 會自動偵測 Node.js 並部署

3. **設定資料庫**
   - 在 Railway 中新增 MySQL 服務
   - 自動獲得連線資訊

4. **部署前端到 Netlify**
   - 連接 GitHub 儲存庫
   - 建置目錄：`client`
   - 建置命令：`npm install && npm run build`
   - 發佈目錄：`client/build`
   - 設定環境變數：`REACT_APP_API_URL=https://your-backend.railway.app/api`

**優點：**
- ✅ 免費方案可用
- ✅ 自動部署
- ✅ 提供資料庫

---

### 選項 B：使用 Render

1. **註冊 Render**
   - 前往：https://render.com

2. **部署後端**
   - 新增 Web Service
   - 連接 GitHub 儲存庫
   - Root Directory：`server`
   - Build Command：`npm install`
   - Start Command：`npm start`

3. **設定資料庫**
   - 新增 PostgreSQL 資料庫（或使用外部 MySQL）
   - 取得連線資訊

4. **部署前端到 Netlify**
   - 同選項 A

---

## 🔧 部署前準備

### 1. 修改前端 API 設定

在 `client/src/utils/api.js` 中，需要根據部署環境設定 API URL：

```javascript
// 開發環境
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';

// 生產環境應該設為後端的實際網址
// 例如：https://your-backend.railway.app/api
```

### 2. 設定環境變數

**前端（Netlify）：**
- `REACT_APP_API_URL` = 後端 API 的網址

**後端（Railway/Render）：**
- `DB_HOST` = 資料庫主機
- `DB_USER` = 資料庫使用者
- `DB_PASSWORD` = 資料庫密碼
- `DB_NAME` = 資料庫名稱
- `JWT_SECRET` = JWT 密鑰
- `EMAIL_USER` = Email 帳號
- `EMAIL_PASS` = Email 密碼

### 3. 修改 CORS 設定

在 `server/index.js` 中，需要允許前端網域的請求：

```javascript
app.use(cors({
  origin: [
    'http://localhost:3000',
    'https://your-netlify-site.netlify.app'  // 加入您的 Netlify 網址
  ],
  credentials: true
}));
```

---

## 🚀 快速部署步驟（Railway + Netlify）

### 步驟 1：準備 GitHub 儲存庫

1. 在 GitHub 建立新儲存庫
2. 上傳所有程式碼
3. 確保 `.gitignore` 包含 `.env` 和 `node_modules`

### 步驟 2：部署後端到 Railway

1. 前往 https://railway.app
2. 點擊「New Project」
3. 選擇「Deploy from GitHub repo」
4. 選擇您的儲存庫
5. 設定：
   - Root Directory：`server`
   - 環境變數：設定所有必要的變數
6. 新增 MySQL 服務
7. 記下後端網址（例如：`https://your-app.railway.app`）

### 步驟 3：部署前端到 Netlify

1. 前往 https://app.netlify.com
2. 點擊「Add new site」→「Import an existing project」
3. 選擇 GitHub 儲存庫
4. 設定：
   - Base directory：`client`
   - Build command：`npm install && npm run build`
   - Publish directory：`client/build`
5. 環境變數：
   - `REACT_APP_API_URL` = `https://your-app.railway.app/api`
6. 部署

### 步驟 4：更新 CORS

在 Railway 後端環境變數中，加入：
```
FRONTEND_URL=https://your-netlify-site.netlify.app
```

並修改 `server/index.js` 的 CORS 設定。

---

## ⚠️ 重要注意事項

### 1. 資料庫遷移

部署到生產環境時，需要：
- 執行 `database/schema.sql` 建立資料表
- 可以使用 Railway 的資料庫管理工具
- 或使用 MySQL Workbench 連線到生產資料庫

### 2. 檔案上傳

目前圖片上傳到本地 `server/uploads/` 目錄，部署時需要：
- 使用雲端儲存（如 AWS S3、Cloudinary）
- 或使用 Railway 的持久化儲存

### 3. Email 設定

確保生產環境的 Email 設定正確：
- Gmail 應用程式密碼
- 或使用其他 SMTP 服務

### 4. 安全性

- ✅ 使用環境變數儲存敏感資訊
- ✅ 設定強密碼
- ✅ 啟用 HTTPS
- ✅ 限制 CORS 來源

---

## 📊 服務比較

| 服務 | 前端 | 後端 | 資料庫 | 免費方案 |
|------|------|------|--------|----------|
| Netlify | ✅ | ❌ | ❌ | ✅ |
| Railway | ✅ | ✅ | ✅ | ✅（有限） |
| Render | ✅ | ✅ | ✅ | ✅（有限） |
| Vercel | ✅ | ✅ | ❌ | ✅ |
| Heroku | ✅ | ✅ | ✅ | ❌（已取消免費） |

---

## 🎯 我的建議

**最簡單的方案：**
1. **後端 + 資料庫** → Railway（一站式）
2. **前端** → Netlify（免費 CDN）

**原因：**
- Railway 提供完整的後端和資料庫服務
- Netlify 提供優秀的前端 CDN
- 兩者都有免費方案
- 設定相對簡單

---

## 📝 下一步

1. 選擇部署方案
2. 準備 GitHub 儲存庫
3. 按照上述步驟部署
4. 測試所有功能

需要我協助建立部署配置檔案嗎？

