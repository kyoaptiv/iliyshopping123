# 部署前檢查清單

## ⚠️ 重要：Netlify 的限制

**Netlify 只能部署前端（React），不能部署：**
- ❌ Node.js 後端 API
- ❌ MySQL 資料庫

**所以您需要：**
- ✅ 前端 → Netlify
- ✅ 後端 API → Railway / Render
- ✅ 資料庫 → Railway / Render

---

## 📋 部署前準備

### 1. 程式碼準備

- [ ] 所有程式碼已上傳到 GitHub
- [ ] `.gitignore` 包含 `.env` 和 `node_modules`
- [ ] 沒有敏感資訊（密碼、API 金鑰）在程式碼中

### 2. 後端準備（Railway）

- [ ] 建立 Railway 帳號
- [ ] 準備環境變數清單：
  ```
  DB_HOST=xxx
  DB_USER=xxx
  DB_PASSWORD=xxx
  DB_NAME=xxx
  JWT_SECRET=xxx
  PORT=5000
  EMAIL_USER=xxx
  EMAIL_PASS=xxx
  FRONTEND_URL=https://your-site.netlify.app
  ```

### 3. 前端準備（Netlify）

- [ ] 準備環境變數：
  ```
  REACT_APP_API_URL=https://your-backend.railway.app/api
  ```

---

## 🚀 部署步驟

### 步驟 1：部署後端到 Railway

1. [ ] 前往 https://railway.app
2. [ ] 建立新專案
3. [ ] 連接 GitHub 儲存庫
4. [ ] 設定 Root Directory：`server`
5. [ ] 新增 MySQL 資料庫服務
6. [ ] 設定所有環境變數
7. [ ] 部署後端
8. [ ] 記下後端網址（例如：`https://your-app.railway.app`）
9. [ ] 初始化資料庫（執行 `database/schema.sql`）
10. [ ] 測試 API：訪問 `https://your-app.railway.app/api/health`

### 步驟 2：部署前端到 Netlify

1. [ ] 前往 https://app.netlify.com
2. [ ] 新增網站 → 從 GitHub 匯入
3. [ ] 選擇儲存庫
4. [ ] 設定建置選項：
   - Base directory：`client`
   - Build command：`npm install && npm run build`
   - Publish directory：`client/build`
5. [ ] 設定環境變數：`REACT_APP_API_URL`
6. [ ] 部署
7. [ ] 記下前端網址（例如：`https://your-site.netlify.app`）

### 步驟 3：更新 CORS 設定

1. [ ] 在 Railway 後端環境變數中新增：`FRONTEND_URL=https://your-site.netlify.app`
2. [ ] 重新部署後端（讓 CORS 設定生效）

---

## ✅ 部署後測試

### 後端測試

- [ ] 訪問 `https://your-backend.railway.app/api/health`
  - 應該看到：`{"status":"OK","message":"益利肉類食品販售網站 API 運行中"}`

### 前端測試

- [ ] 訪問前端網址
- [ ] 檢查瀏覽器開發者工具（F12）→ Console
  - 不應該有 CORS 錯誤
- [ ] 檢查 Network 標籤
  - API 請求應該成功（狀態碼 200）

### 功能測試

- [ ] **前台功能**
  - [ ] 可以瀏覽商品列表
  - [ ] 可以查看商品詳情
  - [ ] 可以加入購物車
  - [ ] 購物車可以正常運作
  - [ ] 可以送出訂單
  - [ ] 訂單 Email 通知正常

- [ ] **後台功能**
  - [ ] 可以登入（admin / 12345）
  - [ ] 可以查看商品列表
  - [ ] 可以新增商品
  - [ ] 可以編輯商品
  - [ ] 可以刪除商品
  - [ ] 可以上傳商品圖片

---

## 🔧 常見問題排除

### 問題 1：前端無法連接到後端

**症狀：** 瀏覽器 Console 顯示 CORS 錯誤或連線失敗

**解決方法：**
1. 檢查 `REACT_APP_API_URL` 是否正確設定
2. 檢查後端 CORS 設定是否允許前端網域
3. 檢查後端是否正在運行

### 問題 2：資料庫連線失敗

**症狀：** 後端日誌顯示資料庫連線錯誤

**解決方法：**
1. 檢查 Railway MySQL 服務是否運行
2. 檢查環境變數是否正確（Railway 會自動設定資料庫變數）
3. 確認資料庫已建立並匯入結構

### 問題 3：圖片無法顯示

**症狀：** 商品圖片顯示為破圖

**解決方法：**
- 目前圖片上傳到本地目錄，部署時需要：
  - 使用雲端儲存（AWS S3、Cloudinary）
  - 或使用 Railway 的持久化儲存

### 問題 4：Email 無法發送

**症狀：** 訂單送出後沒有收到 Email

**解決方法：**
1. 檢查 `EMAIL_USER` 和 `EMAIL_PASS` 是否正確
2. 確認 Gmail 應用程式密碼正確
3. 檢查後端日誌查看錯誤訊息

---

## 📝 部署後維護

### 定期檢查

- [ ] 後端服務是否正常運行
- [ ] 資料庫連線是否正常
- [ ] 前端是否可以正常訪問
- [ ] 所有功能是否正常運作

### 備份

- [ ] 定期備份資料庫
- [ ] 備份環境變數設定
- [ ] 保留程式碼版本控制

---

## 🎯 完成標準

部署完成後，應該能夠：

✅ 在網際網路上訪問網站  
✅ 所有前台功能正常運作  
✅ 所有後台功能正常運作  
✅ 資料可以正常儲存和讀取  
✅ Email 通知正常發送  

---

## 📞 需要幫助？

如果遇到問題，請提供：
1. 錯誤訊息截圖
2. 瀏覽器開發者工具的 Console 和 Network 標籤
3. 後端日誌（Railway 的 Logs）
4. 部署的網址

